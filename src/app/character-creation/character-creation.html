<div class="cc">
  <h1>Create Investigator</h1>
  <mat-horizontal-stepper linear>
    <!-- Info -->
    <mat-step [stepControl]="playerForm" label="Info">
      <form [formGroup]="playerForm" class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Player Name</mat-label>
          <input matInput formControlName="playerName" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Character Name</mat-label>
          <input matInput formControlName="characterName" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Pronouns</mat-label>
          <input matInput formControlName="pronouns" placeholder="e.g., she/her" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Birthplace</mat-label>
          <input matInput formControlName="birthplace" placeholder="City, Country" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Residence</mat-label>
          <input matInput formControlName="residence" placeholder="City, Country" />
        </mat-form-field>

        <div class="step-actions">
          <span></span>
          <button mat-raised-button color="primary" matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Characteristics -->
    <mat-step [stepControl]="characteristicsForm" label="Characteristics">
      <form [formGroup]="characteristicsForm" class="grid grid-4">
        <mat-form-field appearance="outline"><mat-label>STR</mat-label><input matInput type="number" formControlName="str" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>CON</mat-label><input matInput type="number" formControlName="con" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>SIZ</mat-label><input matInput type="number" formControlName="siz" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>DEX</mat-label><input matInput type="number" formControlName="dex" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>APP</mat-label><input matInput type="number" formControlName="app" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>INT</mat-label><input matInput type="number" formControlName="int" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>POW</mat-label><input matInput type="number" formControlName="pow" /></mat-form-field>
        <mat-form-field appearance="outline"><mat-label>EDU</mat-label><input matInput type="number" formControlName="edu" /></mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Age</mat-label>
          <input matInput type="number" formControlName="age"/>
        </mat-form-field>

        @if (characteristicsForm.get('age')?.value ?? 0 >= 15) {
          <div class="hint">
            {{ ageAdvice }}
          </div>
        }

        <mat-form-field appearance="outline" class="full">
          <mat-label>Luck</mat-label>
          <input matInput type="number" formControlName="luck" />
        </mat-form-field>
        
        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Occupation & Skills -->
    <mat-step [stepControl]="occupationForm" label="Occupation & Skills">
      <form [formGroup]="occupationForm" class="grid grid-4">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Occupation</mat-label>
          <input matInput formControlName="occupation" placeholder="e.g., Detective" />
        </mat-form-field>

        <div formArrayName="skills" class="full">
          @for (skill of skills.controls; track $index) {
            <div class="skill-row" [formGroupName]="$index">
              <!-- Name -->
              <mat-form-field appearance="outline" class="name">
                <mat-label>Skill Name</mat-label>
                <input matInput formControlName="name"/>
              </mat-form-field>

              <!-- Points -->
              <mat-form-field appearance="outline" class="points">
                <mat-label>Points</mat-label>
                <input matInput type="number" min="0" formControlName="points" />
              </mat-form-field>

              <!-- Remove (disabled for locked) -->
              <button mat-icon-button color="warn" aria-label="Remove skill" matTooltip="Remove"
                      type="button" (click)="removeSkill($index)">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          }

          <!-- Add skill button below the list -->
          <div class="step-actions">
            <button mat-stroked-button color="primary" type="button" (click)="addSkill()">Add Skill</button>
          </div>
        </div>

        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Backstory & Connections -->
    <mat-step [stepControl]="backstoryForm" label="Backstory & Connections">
      <form [formGroup]="backstoryForm" class="grid">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Backstory</mat-label>
          <textarea matInput rows="5" formControlName="backstory" placeholder="History, ideology/beliefs, traits..."></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Connections</mat-label>
          <textarea matInput rows="4" formControlName="connections" placeholder="Important people, organizations, contacts..."></textarea>
        </mat-form-field>

        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Wealth -->
    <mat-step [stepControl]="wealthForm" label="Wealth">
      <form [formGroup]="wealthForm" class="grid">
        <mat-form-field appearance="outline">
          <mat-label>Credit Rating</mat-label>
          <input matInput type="number" formControlName="creditRating" />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Spending Level</mat-label>
          <input matInput type="number" formControlName="spendingLevel" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Cash</mat-label>
          <input matInput formControlName="cash" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Assets</mat-label>
          <textarea matInput rows="3" formControlName="assets"></textarea>
        </mat-form-field>

        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button mat-raised-button color="primary" (click)="finish()">Finish</button>
        </div>
      </form>
    </mat-step>
  </mat-horizontal-stepper>
</div>