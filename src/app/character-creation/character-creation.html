<div class="cc">
  <h1>Create Investigator</h1>
  <mat-horizontal-stepper linear>
    <!-- Info -->
    <mat-step [stepControl]="playerForm" label="Info">
      <form [formGroup]="playerForm" class="row">
        <mat-form-field appearance="outline" class="info-field col-2">
          <mat-label>Player Name</mat-label>
          <input matInput formControlName="playerName" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field col-2">
          <mat-label>Character Name</mat-label>
          <input matInput formControlName="characterName" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field col-2">
          <mat-label>Pronouns</mat-label>
          <input matInput formControlName="pronouns" placeholder="e.g., she/her" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field col-2">
          <mat-label>Birthplace</mat-label>
          <input matInput formControlName="birthplace" placeholder="City, Country" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="info-field col-2">
          <mat-label>Residence</mat-label>
          <input matInput formControlName="residence" placeholder="City, Country" />
        </mat-form-field>

        <div class="step-actions full">
          <span></span>
          <button matButton="filled" mat-raised-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Characteristics -->
    <mat-step [stepControl]="characteristicsForm" label="Characteristics">
      <form [formGroup]="characteristicsForm" class="row">
        <!-- Roll all button -->
        <div class="full">
          <button mat-stroked-button type="button" (click)="rollAllStats()" matTooltip="Roll all characteristics">
            <mat-icon>casino</mat-icon>
            Roll All
          </button>
        </div>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>STR</mat-label>
          <input matInput type="number" formControlName="str" />
          <button mat-icon-button matSuffix matTooltip="Roll 3d6 × 5" (click)="rollStat('str')" aria-label="Roll STR">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.str }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>CON</mat-label>
          <input matInput type="number" formControlName="con" />
          <button mat-icon-button matSuffix matTooltip="Roll 3d6 × 5" (click)="rollStat('con')" aria-label="Roll CON">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.con }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>SIZ</mat-label>
          <input matInput type="number" formControlName="siz" />
          <button mat-icon-button matSuffix matTooltip="Roll 2d6 + 6" (click)="rollStat('siz')" aria-label="Roll SIZ">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.siz }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>DEX</mat-label>
          <input matInput type="number" formControlName="dex" />
          <button mat-icon-button matSuffix matTooltip="Roll 3d6 × 5" (click)="rollStat('dex')" aria-label="Roll DEX">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.dex }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>APP</mat-label>
          <input matInput type="number" formControlName="app" />
          <button mat-icon-button matSuffix matTooltip="Roll 3d6 × 5" (click)="rollStat('app')" aria-label="Roll APP">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.app }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>INT</mat-label>
          <input matInput type="number" formControlName="int" />
          <button mat-icon-button matSuffix matTooltip="Roll 2d6 + 6" (click)="rollStat('int')" aria-label="Roll INT">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.int }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>POW</mat-label>
          <input matInput type="number" formControlName="pow" />
          <button mat-icon-button matSuffix matTooltip="Roll 3d6 × 5" (click)="rollStat('pow')" aria-label="Roll POW">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.pow }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>EDU</mat-label>
          <input matInput type="number" formControlName="edu" />
          <button mat-icon-button matSuffix matTooltip="Roll 2d6 + 6" (click)="rollStat('edu')" aria-label="Roll EDU">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.edu }}</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Age</mat-label>
          <input matInput type="number" formControlName="age"/>
        </mat-form-field>

        @if (characteristicsForm.get('age')?.value ?? 0 >= 15) {
          <div class="age-hint full">
            {{ ageAdvice }}
          </div>
        }

        <mat-form-field appearance="outline" class="char-stat col-3 short">
          <mat-label>Luck</mat-label>
          <input matInput type="number" formControlName="luck" />
          <button mat-icon-button matSuffix matTooltip="Roll 2d6 + 6" (click)="rollStat('luck')" aria-label="Roll LUCK">
            <mat-icon>casino</mat-icon>
          </button>
          <mat-hint align="end">{{ rollNotes.luck }}</mat-hint>
        </mat-form-field>

        <div class="step-actions full">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button matButton="filled" mat-raised-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Occupation & Skills -->
    <mat-step [stepControl]="occupationForm" label="Occupation & Skills">
      <form [formGroup]="occupationForm" class="row">
        <mat-form-field appearance="outline" class="col-2">
          <mat-label>Occupation</mat-label>
          <input matInput formControlName="occupation" placeholder="e.g., Detective" />
        </mat-form-field>
        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Occupation Skill Points</mat-label>
          <input matInput type="number" min="0" formControlName="occupationPoints" readonly/>
        </mat-form-field>
        <mat-form-field appearance="outline" class="col-4">
          <mat-label>Personal Interest Skill Points</mat-label>
          <input matInput type="number" min="0" formControlName="personalInterestPoints" readonly/>
        </mat-form-field>

        <div class="full" formArrayName="skills">
          @for (skill of skills.controls; let i = $index; track skill) {
            <div class="row" [formGroupName]="i">
              <!-- Is Professional Skill -->
              <mat-checkbox formControlName="isProfessional" matTooltip="Professional Skill" class="skill-button"></mat-checkbox>

              <!-- Name -->
              <mat-form-field appearance="outline" class="col-2">
                <mat-label>Skill Name</mat-label>
                <input matInput formControlName="name"/>
              </mat-form-field>

              <!-- Points -->
              <mat-form-field appearance="outline" class="col-5">
                <mat-label>Points</mat-label>
                <input matInput type="number" min="0" formControlName="points" />
              </mat-form-field>

              <!-- Remove (disabled for locked) -->
              <button mat-icon-button color="warn" aria-label="Remove skill" matTooltip="Remove"
                      type="button" class="skill-button" (click)="removeSkill(i)">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          }

          <!-- Add skill button below the list -->
          <div class="full">
            <button mat-stroked-button type="button" (click)="addSkill()">Add Skill</button>
          </div>
        </div>

        <div class="step-actions full">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button matButton="filled" mat-raised-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Backstory & Connections -->
    <mat-step [stepControl]="backstoryForm" label="Backstory & Connections">
      <form [formGroup]="backstoryForm" class="row">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Backstory</mat-label>
          <textarea matInput rows="5" formControlName="backstory" placeholder="History, ideology/beliefs, traits..."></textarea>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Connections</mat-label>
          <textarea matInput rows="5" formControlName="connections" placeholder="Important people, organizations, contacts..."></textarea>
        </mat-form-field>

        <div class="step-actions full">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button matButton="filled" mat-raised-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Wealth -->
    <mat-step [stepControl]="wealthForm" label="Wealth">
      <form [formGroup]="wealthForm" class="row">
        <mat-form-field appearance="outline" class="col-3">
          <mat-label>Credit Rating</mat-label>
          <input matInput type="number" formControlName="creditRating" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-3">
          <mat-label>Spending Level</mat-label>
          <input matInput type="number" formControlName="spendingLevel" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-3">
          <mat-label>Cash</mat-label>
          <input matInput type="number" formControlName="cash" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="full">
          <mat-label>Assets</mat-label>
          <textarea matInput rows="5" formControlName="assets"></textarea>
        </mat-form-field>

        <div class="step-actions full">
          <button mat-stroked-button matStepperPrevious>Back</button>
          <button matButton="filled" mat-raised-button color="primary" (click)="finish()">Finish</button>
        </div>
      </form>
    </mat-step>
  </mat-horizontal-stepper>
</div>
